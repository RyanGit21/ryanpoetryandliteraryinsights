<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYGKTNNN1P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DYGKTNNN1P');
</script>

<title>Post | Ryan's Poetic and Literary Insights</title>
<meta name="description" content="Read this post from Ryan's collection of poetry and literary insights">
<meta name="keywords" content="poetry, literary blog, creative writing, Ryan poetry">
<meta name="author" content="Ryan">
<meta name="robots" content="index, follow">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="Post | Ryan's Poetic and Literary Insights">
<meta property="og:description" content="Read this post from Ryan's collection">
<meta property="og:site_name" content="Ryan's Poetic and Literary Insights">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Post | Ryan's Poetic and Literary Insights">
<meta name="twitter:description" content="Read this post from Ryan's collection">

<link rel="preconnect" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="dns-prefetch" href="https://zqmgtnnwrceagkshfapq.supabase.co">

<style>
:root{
  --bg-gradient-start:#667eea;
  --bg-gradient-end:#764ba2;
  --card-bg:#ffffff;
  --text-primary:#333333;
  --text-secondary:#666666;
  --text-muted:#999999;
  --border-color:#ddd;
  --shadow:rgba(0,0,0,0.2);
  --accent-blue:#667eea;
  --accent-red:#ff6b6b;
}

[data-theme="dark"]{
  --bg-gradient-start:#1a1a2e;
  --bg-gradient-end:#16213e;
  --card-bg:#2a2a3e;
  --text-primary:#e0e0e0;
  --text-secondary:#b0b0b0;
  --text-muted:#808080;
  --border-color:#444;
  --shadow:rgba(0,0,0,0.5);
  --accent-blue:#7d8ef5;
  --accent-red:#ff8787;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,var(--bg-gradient-start),var(--bg-gradient-end));color:var(--text-primary);line-height:1.6;min-height:100vh;transition:background 0.3s ease}
.container{max-width:900px;margin:0 auto;padding:20px}
.breadcrumb{color:rgba(255,255,255,0.9);padding:20px;font-size:0.9em;text-align:center}
.breadcrumb a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);transition:opacity 0.3s}
.breadcrumb a:hover{opacity:0.7}
.post-full{background:var(--card-bg);border-radius:20px;padding:50px;margin:30px 0;box-shadow:0 10px 40px var(--shadow)}
.post-full.poem{background:linear-gradient(135deg,#ffecd2,#fcb69f);border-left:5px solid var(--accent-red)}
[data-theme="dark"] .post-full.poem{background:linear-gradient(135deg,#3a2a1e,#2e1f14)}
.post-full.article{border-left:5px solid var(--accent-blue)}
.post-full header{border-bottom:2px solid var(--border-color);padding-bottom:25px;margin-bottom:30px}
.post-full h1{color:var(--accent-blue);font-size:2.5em;margin-bottom:15px;line-height:1.3}
.post-full.poem h1{color:var(--accent-red)}
.post-meta{display:flex;gap:20px;flex-wrap:wrap;color:var(--text-muted);font-size:0.95em}
.post-meta time,.reading-time{display:inline-flex;align-items:center;gap:5px}
.reading-time::before{content:"üìñ"}
.post-type-badge{background:var(--accent-blue);color:white;padding:5px 15px;border-radius:20px;font-size:0.85em;font-weight:bold;text-transform:uppercase}
.post-full.poem .post-type-badge{background:var(--accent-red)}
.post-content{font-size:1.15em;line-height:1.9;color:var(--text-secondary)}
.post-content p{margin-bottom:20px}
.post-content p:last-child{margin-bottom:0}
.back-link{text-align:center;margin:30px 0}
.btn{padding:15px 30px;border-radius:8px;cursor:pointer;border:none;font-size:1em;transition:all 0.3s ease;font-weight:bold;text-decoration:none;display:inline-block}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.btn-secondary{background:rgba(255,255,255,0.2);color:white;border:2px solid white}
.btn-secondary:hover{background:rgba(255,255,255,0.3)}
.loading-container{color:white;text-align:center;padding:80px 20px;font-size:1.2em}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top:4px solid white;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.error-container{background:var(--card-bg);border-radius:20px;padding:50px;margin:30px 0;box-shadow:0 10px 40px var(--shadow);text-align:center}
.error-container h2{color:var(--accent-red);margin-bottom:15px}
.error-container p{color:var(--text-secondary);margin-bottom:25px}
.theme-toggle{position:fixed;top:20px;right:20px;width:50px;height:50px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:50%;z-index:100;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;font-size:1.5em}
.theme-toggle:hover{background:rgba(255,255,255,0.3);transform:rotate(20deg)}
.success,.error{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:15px 30px;border-radius:8px;color:white;z-index:3000;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,0.3);animation:slideDown 0.3s ease}
.success{background:#2ecc71}
.error{background:#e74c3c}
@keyframes slideDown{from{top:-100px;opacity:0}to{top:20px;opacity:1}}
footer{background:rgba(0,0,0,0.3);color:white;text-align:center;padding:30px 20px;margin-top:60px}
footer p{margin:5px 0;opacity:0.9}
footer a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.5);transition:opacity 0.3s}
footer a:hover{opacity:0.7}
@media(max-width:768px){
    .post-full{padding:30px 25px}
    .post-full h1{font-size:2em}
    .post-content{font-size:1.05em}
    .post-meta{gap:12px;font-size:0.9em}
}
</style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô</button>

<div class="container">
<nav class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList" aria-label="Breadcrumb">
  <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="index.html">
      <span itemprop="name">Home</span>
    </a>
    <meta itemprop="position" content="1">
  </span>
  <span style="margin:0 8px">‚Ä∫</span>
  <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <span itemprop="name">Loading...</span>
    <meta itemprop="position" content="2">
  </span>
</nav>

<main id="post-container">
<div class="loading-container">
<div class="spinner"></div>
<p>Loading post...</p>
</div>
</main>
</div>

<footer itemscope itemtype="https://schema.org/WPFooter">
<p>&copy; <span itemprop="copyrightYear">2024</span> <span itemprop="copyrightHolder">Ryan's Poetic and Literary Insights</span></p>
<p>Crafted with ‚ù§Ô∏è and words</p>
<p><a href="mailto:ryanlist35@gmail.com" itemprop="email">Contact</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async defer></script>
<script>
const SUPABASE_URL="https://zqmgtnnwrceagkshfapq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbWd0bm53cmNlYWdrc2hmYXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDI2ODgsImV4cCI6MjA4MjI3ODY4OH0.Ql5KP6nfOSRzz1Z2eyN6WTqDsfVwZ0e9GKIbePa9eZE";

let sb;

function loadTheme(){
    const theme=localStorage.getItem('theme')||'light';
    document.documentElement.setAttribute('data-theme',theme);
    document.querySelector('.theme-toggle').textContent=theme==='dark'?'‚òÄÔ∏è':'üåô';
}

function toggleTheme(){
    const current=document.documentElement.getAttribute('data-theme')||'light';
    const next=current==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    document.querySelector('.theme-toggle').textContent=next==='dark'?'‚òÄÔ∏è':'üåô';
}

function calculateReadingTime(text){
    const wordsPerMinute=200;
    const words=text.trim().split(/\s+/).length;
    const minutes=Math.ceil(words/wordsPerMinute);
    return minutes;
}

function escapeHtml(text){
    const div=document.createElement('div');
    div.textContent=text;
    return div.innerHTML;
}

function formatDate(dateString){
    return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
}

function getCachedPost(id){
    try{
        const cached=localStorage.getItem('post_'+id);
        if(!cached)return null;
        const{data,timestamp}=JSON.parse(cached);
        if(Date.now()-timestamp<30*60*1000)return data;
        localStorage.removeItem('post_'+id);
        return null;
    }catch(e){
        return null;
    }
}

function setCachedPost(id,data){
    try{
        localStorage.setItem('post_'+id,JSON.stringify({
            data:data,
            timestamp:Date.now()
        }));
    }catch(e){}
}

async function fetchPostInBackground(id){
    try{
        const{data,error}=await sb.from('posts').select('*').eq('id',id).single();
        if(!error&&data){
            setCachedPost(id,data);
        }
    }catch(e){}
}

function initSupabase(){
    if(window.supabase){
        sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
        loadPost();
    }else{
        setTimeout(initSupabase,100);
    }
}

async function loadPost(){
    const urlParams=new URLSearchParams(window.location.search);
    const postId=urlParams.get('id');
    
    if(!postId){
        showError('No post ID provided');
        return;
    }
    
    const cached=getCachedPost(postId);
    if(cached){
        displayPost(cached);
        fetchPostInBackground(postId);
        return;
    }
    
    try{
        const{data,error}=await Promise.race([
            sb.from('posts').select('*').eq('id',postId).single(),
            new Promise((_,reject)=>setTimeout(()=>reject(new Error('Timeout')),8000))
        ]);
        
        if(error)throw error;
        if(!data)throw new Error('Post not found');
        
        setCachedPost(postId,data);
        displayPost(data);
    }catch(err){
        console.error('Error loading post:',err);
        const fallbackCache=getCachedPost(postId);
        if(fallbackCache){
            displayPost(fallbackCache);
            showMessage('Showing cached version','error');
        }else{
            showError('Failed to load post: '+err.message);
        }
    }
}

function displayPost(post){
    document.title=`${post.title} | Ryan's Poetic and Literary Insights`;
    
    const metaDesc=document.querySelector('meta[name="description"]');
    if(metaDesc)metaDesc.content=post.content.substring(0,150);
    
    const ogTitle=document.querySelector('meta[property="og:title"]');
    if(ogTitle)ogTitle.content=post.title;
    
    const ogDesc=document.querySelector('meta[property="og:description"]');
    if(ogDesc)ogDesc.content=post.content.substring(0,150);
    
    const breadcrumb=document.querySelector('.breadcrumb');
    if(breadcrumb){
        breadcrumb.innerHTML=`
            <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a itemprop="item" href="index.html">
                    <span itemprop="name">Home</span>
                </a>
                <meta itemprop="position" content="1">
            </span>
            <span style="margin:0 8px">‚Ä∫</span>
            <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <span itemprop="name">${escapeHtml(post.title)}</span>
                <meta itemprop="position" content="2">
            </span>
        `;
    }
    
    const readTime=calculateReadingTime(post.content);
    const formattedContent=post.content.split('\n').map(p=>
        p.trim()?`<p>${escapeHtml(p)}</p>`:''
    ).join('');
    
    const postHtml=`
        <article class="post-full ${escapeHtml(post.type)}" itemscope itemtype="https://schema.org/BlogPosting">
            <header>
                <h1 itemprop="headline">${escapeHtml(post.title)}</h1>
                <div class="post-meta">
                    <time itemprop="datePublished" datetime="${post.created_at}">
                        ${formatDate(post.created_at)}
                    </time>
                    <span class="reading-time" itemprop="timeRequired" content="PT${readTime}M">
                        ${readTime} min read
                    </span>
                    <span class="post-type-badge">${post.type}</span>
                </div>
            </header>
            <div class="post-content" itemprop="articleBody">
                ${formattedContent}
            </div>
            <meta itemprop="author" content="Ryan">
            <meta itemprop="dateModified" content="${post.created_at}">
        </article>
        <div class="back-link">
            <a href="index.html" class="btn btn-secondary">‚Üê Back to all posts</a>
        </div>
    `;
    
    document.getElementById('post-container').innerHTML=postHtml;
    
    if(window.requestIdleCallback){
        requestIdleCallback(()=>injectStructuredData(post),{timeout:1000});
    }else{
        setTimeout(()=>injectStructuredData(post),0);
    }
}

function injectStructuredData(post){
    const existingScript=document.getElementById('post-schema');
    if(existingScript)existingScript.remove();
    
    const schema={
        "@context":"https://schema.org",
        "@type":"BlogPosting",
        "headline":post.title,
        "datePublished":post.created_at,
        "dateModified":post.created_at,
        "author":{
            "@type":"Person",
            "name":"Ryan"
        },
        "publisher":{
            "@type":"Person",
            "name":"Ryan"
        },
        "description":post.content.substring(0,150),
        "articleBody":post.content,
        "wordCount":post.content.split(/\s+/).length,
        "inLanguage":"en-US"
    };
    
    const script=document.createElement('script');
    script.type='application/ld+json';
    script.id='post-schema';
    script.textContent=JSON.stringify(schema);
    document.head.appendChild(script);
}

function showError(message){
    document.getElementById('post-container').innerHTML=`
        <div class="error-container">
            <h2>Oops!</h2>
            <p>${escapeHtml(message)}</p>
            <a href="index.html" class="btn btn-secondary">‚Üê Back to all posts</a>
        </div>
    `;
}

function showMessage(text,type){
    const msg=document.createElement('div');
    msg.className=type;
    msg.textContent=text;
    msg.setAttribute('role','alert');
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
}

loadTheme();
initSupabase();
</script>
</body>
</html>
