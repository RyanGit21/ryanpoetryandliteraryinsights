<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYGKTNNN1P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DYGKTNNN1P');
</script>

<title>Loading Post... - Ryan's Poetic and Literary Insights</title>
<meta name="description" content="Read this post on Ryan's Poetic and Literary Insights - A collection of poetry, stories, and literary articles">
<meta name="author" content="Ryan">
<meta name="robots" content="index, follow">
<meta http-equiv="content-language" content="en-US">

<link rel="canonical" id="canonical-url" href="">

<meta property="og:site_name" content="Ryan's Poetic and Literary Insights">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ryan">

<meta name="twitter:card" content="summary_large_image">

<link rel="preconnect" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="dns-prefetch" href="https://zqmgtnnwrceagkshfapq.supabase.co">

<style>
:root{
  --bg-gradient-start:#667eea;
  --bg-gradient-end:#764ba2;
  --card-bg:#ffffff;
  --text-primary:#333333;
  --text-secondary:#666666;
  --text-muted:#999999;
  --border-color:#ddd;
  --shadow:rgba(0,0,0,0.2);
  --accent-blue:#667eea;
  --accent-red:#ff6b6b;
}

[data-theme="dark"]{
  --bg-gradient-start:#1a1a2e;
  --bg-gradient-end:#16213e;
  --card-bg:#2a2a3e;
  --text-primary:#e0e0e0;
  --text-secondary:#b0b0b0;
  --text-muted:#808080;
  --border-color:#444;
  --shadow:rgba(0,0,0,0.5);
  --accent-blue:#7d8ef5;
  --accent-red:#ff8787;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,var(--bg-gradient-start),var(--bg-gradient-end));color:var(--text-primary);line-height:1.8;min-height:100vh;transition:background 0.3s ease}
.container{max-width:900px;margin:0 auto;padding:20px}
.breadcrumb{color:rgba(255,255,255,0.9);padding:20px;font-size:0.9em}
.breadcrumb a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);transition:opacity 0.3s;margin:0 5px}
.breadcrumb a:hover{opacity:0.7}
.breadcrumb span{margin:0 5px;opacity:0.6}
.back-btn{display:inline-block;padding:10px 20px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;text-decoration:none;border-radius:25px;margin:20px;transition:all 0.3s ease;font-weight:bold}
.back-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-2px)}
.post-container{background:var(--card-bg);border-radius:20px;padding:50px;margin:20px;box-shadow:0 15px 50px var(--shadow);min-height:400px}
.post-header{border-bottom:3px solid var(--accent-blue);padding-bottom:30px;margin-bottom:40px}
.post-header.poem{border-bottom-color:var(--accent-red)}
.post-title{font-size:2.8em;color:var(--accent-blue);margin-bottom:20px;line-height:1.3}
.post-header.poem .post-title{color:var(--accent-red)}
.post-meta{display:flex;gap:30px;flex-wrap:wrap;color:var(--text-muted);font-size:0.95em;align-items:center}
.post-type{display:inline-block;padding:8px 20px;background:var(--accent-blue);color:white;border-radius:20px;font-weight:bold;text-transform:uppercase;font-size:0.85em}
.post-header.poem .post-type{background:var(--accent-red)}
.post-content{font-size:1.15em;line-height:2;color:var(--text-primary);white-space:pre-wrap;word-wrap:break-word}
.post-content.poem{font-style:italic;text-align:left;padding-left:40px}
.loading-container{color:white;text-align:center;padding:100px 20px;font-size:1.3em}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top:4px solid white;width:60px;height:60px;animation:spin 1s linear infinite;margin:30px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.error-state{color:white;text-align:center;padding:100px 20px;font-size:1.2em;background:rgba(255,255,255,0.1);border-radius:15px;margin:20px}
.error-state h2{font-size:2em;margin-bottom:20px}
.share-buttons{margin-top:50px;padding-top:30px;border-top:2px solid var(--border-color);display:flex;gap:15px;flex-wrap:wrap}
.share-btn{padding:10px 20px;background:var(--accent-blue);color:white;text-decoration:none;border-radius:25px;transition:all 0.3s ease;font-weight:bold;display:inline-flex;align-items:center;gap:8px}
.share-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px var(--shadow)}
.theme-toggle{position:fixed;top:20px;right:20px;width:50px;height:50px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:50%;z-index:100;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;font-size:1.5em}
.theme-toggle:hover{background:rgba(255,255,255,0.3);transform:rotate(20deg)}
.reading-time{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background:rgba(102,126,234,0.1);border-radius:20px;color:var(--text-muted)}
.reading-time::before{content:"üìñ"}
footer{background:rgba(0,0,0,0.3);color:white;text-align:center;padding:30px 20px;margin-top:60px}
footer p{margin:5px 0;opacity:0.9}
footer a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.5);transition:opacity 0.3s}
footer a:hover{opacity:0.7}

@media(max-width:768px){
    .post-container{padding:30px 20px;margin:10px}
    .post-title{font-size:2em}
    .post-content{font-size:1.05em;padding-left:0}
    .post-content.poem{padding-left:20px}
    .breadcrumb{padding:15px 10px}
    .back-btn{margin:10px}
    .post-meta{gap:15px}
    .share-buttons{gap:10px}
}
</style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô</button>

<div class="container">
<nav class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList" aria-label="Breadcrumb">
  <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="https://ryangit21.github.io/ryanpoetryandliteraryinsights/">
      <span itemprop="name">Home</span>
    </a>
    <meta itemprop="position" content="1">
  </span>
  <span>‚Ä∫</span>
  <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <span itemprop="name" id="breadcrumb-title">Post</span>
    <meta itemprop="position" content="2">
  </span>
</nav>

<a href="index.html" class="back-btn">‚Üê Back to All Posts</a>

<article id="post-container" class="post-container">
<div class="loading-container">
<div class="spinner"></div>
<p>Loading post...</p>
</div>
</article>
</div>

<footer itemscope itemtype="https://schema.org/WPFooter">
<p>&copy; <span itemprop="copyrightYear">2024</span> <span itemprop="copyrightHolder">Ryan's Poetic and Literary Insights</span></p>
<p>Crafted with ‚ù§Ô∏è and words</p>
<p><a href="mailto:ryanlist35@gmail.com" itemprop="email">Contact</a> | <a href="index.html">Home</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL="https://zqmgtnnwrceagkshfapq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbWd0bm53cmNlYWdrc2hmYXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDI2ODgsImV4cCI6MjA4MjI3ODY4OH0.Ql5KP6nfOSRzz1Z2eyN6WTqDsfVwZ0e9GKIbePa9eZE";

let sb;
const CACHE_PREFIX='post_';
const CACHE_DURATION=30*60*1000;

function loadTheme(){
    const theme=localStorage.getItem('theme')||'light';
    document.documentElement.setAttribute('data-theme',theme);
    document.querySelector('.theme-toggle').textContent=theme==='dark'?'‚òÄÔ∏è':'üåô';
}

function toggleTheme(){
    const current=document.documentElement.getAttribute('data-theme')||'light';
    const next=current==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    document.querySelector('.theme-toggle').textContent=next==='dark'?'‚òÄÔ∏è':'üåô';
}

function getPostIdFromUrl(){
    const params=new URLSearchParams(window.location.search);
    return params.get('id');
}

function getCachedPost(id){
    try{
        const cached=localStorage.getItem(CACHE_PREFIX+id);
        if(!cached)return null;
        const{data,timestamp}=JSON.parse(cached);
        if(Date.now()-timestamp<CACHE_DURATION)return data;
        localStorage.removeItem(CACHE_PREFIX+id);
        return null;
    }catch(e){return null}
}

function setCachedPost(id,post){
    try{
        localStorage.setItem(CACHE_PREFIX+id,JSON.stringify({data:post,timestamp:Date.now()}));
    }catch(e){}
}

function calculateReadingTime(text){
    const wordsPerMinute=200;
    const words=text.trim().split(/\s+/).length;
    const minutes=Math.ceil(words/wordsPerMinute);
    return minutes;
}

function formatDate(dateString){
    return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
}

function escapeHtml(text){
    const div=document.createElement('div');
    div.textContent=text;
    return div.innerHTML;
}

function updateMetaTags(post){
    const postUrl=`https://ryangit21.github.io/ryanpoetryandliteraryinsights/post.html?id=${post.id}`;
    const description=post.content.substring(0,150).replace(/\n/g,' ').trim();
    
    document.title=`${post.title} - Ryan's Poetic and Literary Insights`;
    
    document.querySelector('meta[name="description"]').setAttribute('content',description);
    document.getElementById('canonical-url').setAttribute('href',postUrl);
    
    const ogTitle=document.querySelector('meta[property="og:title"]');
    if(ogTitle){
        ogTitle.setAttribute('content',post.title);
    }else{
        const meta=document.createElement('meta');
        meta.setAttribute('property','og:title');
        meta.setAttribute('content',post.title);
        document.head.appendChild(meta);
    }
    
    const ogDesc=document.querySelector('meta[property="og:description"]');
    if(ogDesc){
        ogDesc.setAttribute('content',description);
    }else{
        const meta=document.createElement('meta');
        meta.setAttribute('property','og:description');
        meta.setAttribute('content',description);
        document.head.appendChild(meta);
    }
    
    const ogUrl=document.querySelector('meta[property="og:url"]');
    if(ogUrl){
        ogUrl.setAttribute('content',postUrl);
    }else{
        const meta=document.createElement('meta');
        meta.setAttribute('property','og:url');
        meta.setAttribute('content',postUrl);
        document.head.appendChild(meta);
    }
    
    const twitterTitle=document.querySelector('meta[name="twitter:title"]');
    if(twitterTitle){
        twitterTitle.setAttribute('content',post.title);
    }else{
        const meta=document.createElement('meta');
        meta.setAttribute('name','twitter:title');
        meta.setAttribute('content',post.title);
        document.head.appendChild(meta);
    }
    
    const twitterDesc=document.querySelector('meta[name="twitter:description"]');
    if(twitterDesc){
        twitterDesc.setAttribute('content',description);
    }else{
        const meta=document.createElement('meta');
        meta.setAttribute('name','twitter:description');
        meta.setAttribute('content',description);
        document.head.appendChild(meta);
    }
    
    document.getElementById('breadcrumb-title').textContent=post.title;
}

function injectStructuredData(post){
    const existingScript=document.getElementById('post-schema');
    if(existingScript)existingScript.remove();
    
    const readTime=calculateReadingTime(post.content);
    const postUrl=`https://ryangit21.github.io/ryanpoetryandliteraryinsights/post.html?id=${post.id}`;
    
    const schema={
        "@context":"https://schema.org",
        "@type":"BlogPosting",
        "headline":post.title,
        "datePublished":post.created_at,
        "dateModified":post.created_at,
        "author":{
            "@type":"Person",
            "name":"Ryan",
            "email":"ryanlist35@gmail.com"
        },
        "publisher":{
            "@type":"Person",
            "name":"Ryan"
        },
        "description":post.content.substring(0,150),
        "articleBody":post.content,
        "url":postUrl,
        "mainEntityOfPage":{
            "@type":"WebPage",
            "@id":postUrl
        },
        "wordCount":post.content.split(/\s+/).length,
        "timeRequired":`PT${readTime}M`,
        "inLanguage":"en-US",
        "genre":post.type==='poem'?"Poetry":"Article"
    };
    
    const script=document.createElement('script');
    script.type='application/ld+json';
    script.id='post-schema';
    script.textContent=JSON.stringify(schema);
    document.head.appendChild(script);
}

function displayPost(post){
    const container=document.getElementById('post-container');
    const readTime=calculateReadingTime(post.content);
    const postUrl=`https://ryangit21.github.io/ryanpoetryandliteraryinsights/post.html?id=${post.id}`;
    const shareText=encodeURIComponent(post.title);
    const shareUrl=encodeURIComponent(postUrl);
    
    container.innerHTML=`
        <div class="post-header ${post.type}" itemscope itemtype="https://schema.org/BlogPosting">
            <h1 class="post-title" itemprop="headline">${escapeHtml(post.title)}</h1>
            <div class="post-meta">
                <span class="post-type" itemprop="genre">${escapeHtml(post.type)}</span>
                <time itemprop="datePublished" datetime="${post.created_at}">${formatDate(post.created_at)}</time>
                <span class="reading-time" itemprop="timeRequired" content="PT${readTime}M">${readTime} min read</span>
            </div>
            <meta itemprop="author" content="Ryan">
            <meta itemprop="publisher" content="Ryan">
            <link itemprop="url" href="${postUrl}">
            <meta itemprop="wordCount" content="${post.content.split(/\s+/).length}">
            <meta itemprop="inLanguage" content="en-US">
        </div>
        <div class="post-content ${post.type}" itemprop="articleBody">${escapeHtml(post.content)}</div>
        <div class="share-buttons">
            <a href="https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}" target="_blank" rel="noopener noreferrer" class="share-btn" aria-label="Share on Twitter">
                üê¶ Share on Twitter
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" target="_blank" rel="noopener noreferrer" class="share-btn" aria-label="Share on Facebook">
                üìò Share on Facebook
            </a>
            <a href="mailto:?subject=${shareText}&body=Check out this post: ${shareUrl}" class="share-btn" aria-label="Share via Email">
                ‚úâÔ∏è Share via Email
            </a>
        </div>
    `;
    
    updateMetaTags(post);
    injectStructuredData(post);
}

function showError(message){
    const container=document.getElementById('post-container');
    container.innerHTML=`
        <div class="error-state">
            <h2>Post Not Found</h2>
            <p>${escapeHtml(message)}</p>
            <a href="index.html" class="back-btn" style="display:inline-block;margin-top:20px;">Return to Home</a>
        </div>
    `;
}

async function loadPost(){
    const postId=getPostIdFromUrl();
    
    if(!postId){
        showError('No post ID provided in URL');
        return;
    }
    
    try{
        const cachedPost=getCachedPost(postId);
        if(cachedPost){
            displayPost(cachedPost);
            fetchPostInBackground(postId);
            return;
        }
        
        if(!sb){
            await new Promise(resolve=>{
                const checkSupabase=setInterval(()=>{
                    if(window.supabase){
                        sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
                        clearInterval(checkSupabase);
                        resolve();
                    }
                },100);
            });
        }
        
        const{data,error}=await Promise.race([
            sb.from('posts').select('*').eq('id',postId).single(),
            new Promise((_,reject)=>setTimeout(()=>reject(new Error('Timeout')),10000))
        ]);
        
        if(error)throw error;
        if(!data)throw new Error('Post not found');
        
        displayPost(data);
        setCachedPost(postId,data);
    }catch(err){
        console.error('Error loading post:',err);
        
        const cachedPost=getCachedPost(postId);
        if(cachedPost){
            displayPost(cachedPost);
        }else{
            showError('Unable to load this post. Please check your connection and try again.');
        }
    }
}

async function fetchPostInBackground(postId){
    try{
        if(!sb)return;
        const{data,error}=await sb.from('posts').select('*').eq('id',postId).single();
        if(!error&&data){
            setCachedPost(postId,data);
            displayPost(data);
        }
    }catch(e){}
}

loadTheme();
loadPost();
</script>
</body>
</html>
