<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYGKTNNN1P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DYGKTNNN1P');
</script>

<title>Post - Ryan's Poetic and Literary Insights</title>
<meta name="description" content="Read the full post on Ryan's Poetic and Literary Insights">
<meta name="author" content="Ryan">
<meta name="robots" content="index, follow">

<link rel="preconnect" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="dns-prefetch" href="https://zqmgtnnwrceagkshfapq.supabase.co">

<style>
:root{
  --bg-gradient-start:#667eea;
  --bg-gradient-end:#764ba2;
  --card-bg:#ffffff;
  --text-primary:#333333;
  --text-secondary:#666666;
  --text-muted:#999999;
  --border-color:#ddd;
  --shadow:rgba(0,0,0,0.2);
  --accent-blue:#667eea;
  --accent-red:#ff6b6b;
}

[data-theme="dark"]{
  --bg-gradient-start:#1a1a2e;
  --bg-gradient-end:#16213e;
  --card-bg:#2a2a3e;
  --text-primary:#e0e0e0;
  --text-secondary:#b0b0b0;
  --text-muted:#808080;
  --border-color:#444;
  --shadow:rgba(0,0,0,0.5);
  --accent-blue:#7d8ef5;
  --accent-red:#ff8787;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,var(--bg-gradient-start),var(--bg-gradient-end));color:var(--text-primary);line-height:1.6;min-height:100vh;transition:background 0.3s ease}
.container{max-width:900px;margin:0 auto;padding:20px}
.theme-toggle{position:fixed;top:20px;right:20px;width:50px;height:50px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:50%;z-index:100;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;font-size:1.5em}
.theme-toggle:hover{background:rgba(255,255,255,0.3);transform:rotate(20deg)}
.breadcrumb{color:rgba(255,255,255,0.9);padding:20px 0;font-size:0.9em}
.breadcrumb a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);transition:opacity 0.3s}
.breadcrumb a:hover{opacity:0.7}
.post-content{background:var(--card-bg);border-radius:20px;padding:50px;box-shadow:0 10px 40px var(--shadow);margin:30px 0}
.post-title{color:var(--accent-blue);font-size:3em;margin-bottom:20px;line-height:1.2}
.post-meta{color:var(--text-muted);font-size:0.95em;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid var(--border-color)}
.post-body{color:var(--text-primary);font-size:1.2em;line-height:1.9;white-space:pre-wrap;word-wrap:break-word}
.post-content.poem{font-style:italic;background:linear-gradient(135deg,#ffecd2,#fcb69f);border-left:5px solid var(--accent-red)}
[data-theme="dark"] .post-content.poem{background:linear-gradient(135deg,#3a2a1e,#2e1f14)}
.post-content.poem .post-title{color:var(--accent-red)}
.back-btn{display:inline-block;padding:15px 30px;background:var(--accent-blue);color:white;text-decoration:none;border-radius:30px;margin-top:30px;transition:all 0.3s ease;font-weight:bold}
.back-btn:hover{background:#5568d3;transform:translateY(-2px)}
.loading-container{color:white;text-align:center;padding:100px 20px;font-size:1.2em}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top:4px solid white;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.error-state{color:white;text-align:center;padding:100px 20px;background:rgba(255,255,255,0.1);border-radius:15px;margin:50px 0}
.error-state h2{font-size:2em;margin-bottom:15px}
.success,.error{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:15px 30px;border-radius:8px;color:white;z-index:3000;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,0.3);animation:slideDown 0.3s ease}
.success{background:#2ecc71}
.error{background:#e74c3c}
@keyframes slideDown{from{top:-100px;opacity:0}to{top:20px;opacity:1}}

.comments-section{margin-top:60px;padding-top:40px;border-top:2px solid rgba(255,255,255,0.2)}
.comments-title{color:white;font-size:2em;margin-bottom:30px}
.comment-form{background:var(--card-bg);padding:30px;border-radius:15px;margin-bottom:30px}
.comment-form h3{color:var(--accent-blue);margin-bottom:20px}
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:8px;font-weight:bold;color:var(--text-primary)}
.form-group input,.form-group textarea{width:100%;padding:12px;border-radius:8px;border:2px solid var(--border-color);font-family:inherit;font-size:1em;background:var(--card-bg);color:var(--text-primary);transition:border-color 0.3s}
.form-group input:focus,.form-group textarea:focus{outline:none;border-color:var(--accent-blue)}
.form-group textarea{min-height:120px;resize:vertical}
.submit-btn{padding:15px 30px;background:var(--accent-blue);color:white;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:bold;transition:all 0.3s ease}
.submit-btn:hover{background:#5568d3;transform:translateY(-2px)}
.comment-item{background:var(--card-bg);padding:25px;border-radius:15px;margin-bottom:20px;box-shadow:0 5px 15px var(--shadow)}
.comment-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px}
.comment-author{color:var(--accent-blue);margin:0;font-size:1.2em}
.comment-date{color:var(--text-muted);font-size:0.9em}
.comment-content{color:var(--text-primary);line-height:1.8;margin:0;white-space:pre-wrap;word-wrap:break-word}
.no-comments{color:white;text-align:center;padding:40px;background:rgba(255,255,255,0.1);border-radius:15px}
.comments-error{color:#e74c3c;text-align:center;padding:20px;background:rgba(231,76,60,0.1);border-radius:15px}

@media(max-width:768px){
    .container{padding:15px}
    .post-content{padding:30px 20px}
    .post-title{font-size:2em}
    .post-body{font-size:1.1em}
    .comment-form{padding:20px}
    .theme-toggle{top:10px;right:10px}
}
</style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô</button>

<div class="container">
<nav class="breadcrumb" aria-label="Breadcrumb">
  <a href="index.html">‚Üê Back to Home</a>
</nav>

<main id="post-container">
<div class="loading-container">
<div class="spinner"></div>
<p>Loading post...</p>
</div>
</main>

<section id="comments-section" class="comments-section" style="display:none">
<h2 class="comments-title">Comments</h2>

<div class="comment-form">
<h3>Leave a Comment</h3>
<div class="form-group">
<label for="comment-name">Name:</label>
<input type="text" id="comment-name" placeholder="Your name" maxlength="100">
</div>
<div class="form-group">
<label for="comment-content">Comment:</label>
<textarea id="comment-content" placeholder="Write your comment..." maxlength="1000"></textarea>
</div>
<button class="submit-btn" onclick="submitComment()">Post Comment</button>
</div>

<div id="comments-list"></div>
</section>

<a href="index.html" class="back-btn" id="back-btn" style="display:none">‚Üê Back to All Posts</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async defer></script>
<script>
const SUPABASE_URL="https://zqmgtnnwrceagkshfapq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbWd0bm53cmNlYWdrc2hmYXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDI2ODgsImV4cCI6MjA4MjI3ODY4OH0.Ql5KP6nfOSRzz1Z2eyN6WTqDsfVwZ0e9GKIbePa9eZE";

let sb;
let currentPostId=null;

function loadTheme(){
    const theme=localStorage.getItem('theme')||'light';
    document.documentElement.setAttribute('data-theme',theme);
    document.querySelector('.theme-toggle').textContent=theme==='dark'?'‚òÄÔ∏è':'üåô';
}

function toggleTheme(){
    const current=document.documentElement.getAttribute('data-theme')||'light';
    const next=current==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    document.querySelector('.theme-toggle').textContent=next==='dark'?'‚òÄÔ∏è':'üåô';
}

function escapeHtml(text){
    const div=document.createElement('div');
    div.textContent=text;
    return div.innerHTML;
}

function formatDate(dateString){
    if(!dateString)return'';
    const date=new Date(dateString);
    if(isNaN(date.getTime()))return'';
    return date.toLocaleDateString('en-US',{
        timeZone:'UTC',
        year:'numeric',
        month:'long',
        day:'numeric'
    });
}

function formatCommentDate(dateString){
    if(!dateString)return'';
    const date=new Date(dateString);
    if(isNaN(date.getTime()))return'';
    return date.toLocaleDateString('en-US',{
        year:'numeric',
        month:'long',
        day:'numeric',
        hour:'2-digit',
        minute:'2-digit'
    });
}

function initSupabase(){
    if(window.supabase){
        sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
        loadPost();
    }else{
        setTimeout(initSupabase,100);
    }
}

async function loadPost(){
    const urlParams=new URLSearchParams(window.location.search);
    const id=urlParams.get('id');
    
    if(!id){
        document.getElementById('post-container').innerHTML=
            '<div class="error-state"><h2>Post Not Found</h2><p>The post you\'re looking for doesn\'t exist.</p></div>';
        document.getElementById('back-btn').style.display='inline-block';
        return;
    }
    
    currentPostId=id;
    
    try{
        const CACHE_PREFIX='post_';
        let post=null;
        
        try{
            const cached=localStorage.getItem(CACHE_PREFIX+id);
            if(cached){
                const{data,timestamp}=JSON.parse(cached);
                if(Date.now()-timestamp<30*60*1000){
                    post=data;
                }
            }
        }catch(e){}
        
        if(!post){
            const{data,error}=await sb.from('posts').select('*').eq('id',id).single();
            if(error)throw error;
            post=data;
            
            try{
                localStorage.setItem(CACHE_PREFIX+id,JSON.stringify({data:post,timestamp:Date.now()}));
            }catch(e){}
        }
        
        if(!post){
            throw new Error('Post not found');
        }
        
        const formattedDate=formatDate(post.created_at);
        
        const postContainer=document.getElementById('post-container');
        postContainer.innerHTML=`
            <article class="post-content ${post.type}" itemscope itemtype="https://schema.org/BlogPosting">
                <h1 class="post-title" itemprop="headline">${escapeHtml(post.title)}</h1>
                ${formattedDate?`<div class="post-meta">
                    <time itemprop="datePublished" datetime="${post.created_at}">
                        Published on ${formattedDate}
                    </time>
                    <meta itemprop="author" content="Ryan">
                </div>`:''}
                <div class="post-body" itemprop="articleBody">${escapeHtml(post.content)}</div>
            </article>
        `;
        
        document.title=`${post.title} - Ryan's Poetic and Literary Insights`;
        
        const metaDesc=document.querySelector('meta[name="description"]');
        if(metaDesc){
            metaDesc.setAttribute('content',post.content.substring(0,150)+'...');
        }
        
        document.getElementById('back-btn').style.display='inline-block';
        document.getElementById('comments-section').style.display='block';
        
        await loadComments();
        
    }catch(err){
        console.error('Error loading post:',err);
        document.getElementById('post-container').innerHTML=
            '<div class="error-state"><h2>Error Loading Post</h2><p>Unable to load the post. Please try again later.</p></div>';
        document.getElementById('back-btn').style.display='inline-block';
    }
}

async function loadComments(){
    if(!currentPostId)return;
    
    try{
        const{data,error}=await sb
            .from('comments')
            .select('*')
            .eq('post_id',currentPostId)
            .order('created_at',{ascending:false});
        
        if(error)throw error;
        
        const commentsList=document.getElementById('comments-list');
        
        if(!data||data.length===0){
            commentsList.innerHTML='<div class="no-comments">No comments yet. Be the first to comment!</div>';
            return;
        }
        
        commentsList.innerHTML=data.map(comment=>{
            const formattedDate=formatCommentDate(comment.created_at);
            
            return `
                <div class="comment-item">
                    <div class="comment-header">
                        <h4 class="comment-author">${escapeHtml(comment.author_name)}</h4>
                        <span class="comment-date">${formattedDate}</span>
                    </div>
                    <p class="comment-content">${escapeHtml(comment.content)}</p>
                </div>
            `;
        }).join('');
        
    }catch(err){
        console.error('Error loading comments:',err);
        document.getElementById('comments-list').innerHTML=
            '<div class="comments-error">Error loading comments. Please try again later.</div>';
    }
}

async function submitComment(){
    const nameInput=document.getElementById('comment-name');
    const contentInput=document.getElementById('comment-content');
    
    const name=nameInput.value.trim();
    const content=contentInput.value.trim();
    
    if(!name||!content){
        showMessage('Please fill in all fields','error');
        return;
    }
    
    if(name.length>100){
        showMessage('Name is too long (max 100 characters)','error');
        return;
    }
    
    if(content.length>1000){
        showMessage('Comment is too long (max 1000 characters)','error');
        return;
    }
    
    if(!currentPostId){
        showMessage('Post ID not found','error');
        return;
    }
    
    try{
        const{error}=await sb
            .from('comments')
            .insert([{
                post_id:currentPostId,
                author_name:name,
                content:content
            }]);
        
        if(error)throw error;
        
        nameInput.value='';
        contentInput.value='';
        
        showMessage('Comment posted successfully!','success');
        
        await loadComments();
        
    }catch(err){
        console.error('Error posting comment:',err);
        showMessage('Error posting comment: '+err.message,'error');
    }
}

function showMessage(text,type){
    const msg=document.createElement('div');
    msg.className=type;
    msg.textContent=text;
    msg.setAttribute('role','alert');
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
}

loadTheme();
initSupabase();
</script>
</body>
</html>
