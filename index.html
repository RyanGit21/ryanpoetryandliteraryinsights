<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ryan's Poetic and Literary Insights - Poetry, Stories & Articles</title>
<meta name="description" content="Explore Ryan's collection of poetry, literary articles, and creative writing. Discover thought-provoking stories and beautiful poems about life, art, and culture.">
<meta name="keywords" content="poetry, literature, creative writing, articles, poems, Ryan's blog, literary insights">
<meta name="author" content="Ryan">
<meta name="robots" content="index, follow">

<meta property="og:title" content="Ryan's Poetic and Literary Insights">
<meta property="og:description" content="A collection of poetry, stories, and literary articles">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ryangit21.github.io/ryanpoetryandliteraryinsights/">

<!-- Preconnect to Supabase for faster loading -->
<link rel="preconnect" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="dns-prefetch" href="https://zqmgtnnwrceagkshfapq.supabase.co">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#333;line-height:1.6;min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:20px}
header{text-align:center;padding:60px 20px;color:white}
header h1{font-size:3.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}
header p{font-size:1.3em;opacity:0.9}
nav{display:flex;justify-content:center;gap:20px;margin:30px 0;flex-wrap:wrap}
.nav-btn{padding:12px 30px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:30px;transition:all 0.3s ease;font-size:1em}
.nav-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-2px)}
.nav-btn.active{background:white;color:#667eea;font-weight:bold}
.posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:30px;margin-bottom:60px}
.post-card{background:white;border-radius:15px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,0.2);cursor:pointer;transition:transform 0.3s ease,box-shadow 0.3s ease}
.post-card:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,0.3)}
.post-card h3{color:#667eea;margin-bottom:10px;font-size:1.5em}
.post-card.poem{font-style:italic;background:linear-gradient(135deg,#ffecd2,#fcb69f);border-left:5px solid #ff6b6b}
.post-card.article{border-left:5px solid #667eea}
.post-date{color:#999;font-size:0.9em;margin:10px 0;font-weight:normal}
.post-excerpt{color:#666;line-height:1.8;margin-top:15px}
.loading-container{color:white;text-align:center;padding:80px 20px;font-size:1.2em}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top:4px solid white;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.empty-state{color:white;text-align:center;padding:80px 20px;font-size:1.2em;background:rgba(255,255,255,0.1);border-radius:15px;margin:20px 0}
.empty-state h3{font-size:1.8em;margin-bottom:15px}
footer{background:rgba(0,0,0,0.3);color:white;text-align:center;padding:30px 20px;margin-top:60px}
footer p{margin:5px 0;opacity:0.9}
footer a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.5);transition:opacity 0.3s}
footer a:hover{opacity:0.7}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:2000;justify-content:center;align-items:center;padding:20px}
.modal.active{display:flex}
.modal-content{background:white;padding:40px;border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}
.modal-content h2{color:#667eea;margin-bottom:25px;font-size:2em}
.form-group{margin-bottom:20px}
.form-group label{font-weight:bold;display:block;margin-bottom:8px;color:#667eea}
.form-group input,textarea,select{width:100%;padding:12px;border-radius:8px;border:2px solid #ddd;font-family:inherit;font-size:1em;transition:border-color 0.3s}
.form-group input:focus,textarea:focus,select:focus{outline:none;border-color:#667eea}
textarea{min-height:200px;resize:vertical}
.btn-group{display:flex;gap:15px;margin-top:20px;flex-wrap:wrap}
.btn{padding:15px 30px;border-radius:8px;cursor:pointer;border:none;font-size:1em;transition:all 0.3s ease;font-weight:bold}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.btn-primary{background:#667eea;color:white}
.btn-primary:hover{background:#5568d3}
.btn-secondary{background:#ddd;color:#333}
.btn-secondary:hover{background:#ccc}
.btn-danger{background:#e74c3c;color:white}
.btn-danger:hover{background:#c0392b}
.admin-btn{position:fixed;top:20px;right:20px;padding:10px 20px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:25px;z-index:100;transition:all 0.3s ease;font-weight:bold}
.admin-btn:hover{background:rgba(255,255,255,0.3)}
.add-post-btn{position:fixed;bottom:40px;right:40px;width:60px;height:60px;background:#667eea;color:white;border-radius:50%;font-size:2em;border:none;cursor:pointer;display:none;z-index:1000;box-shadow:0 5px 20px rgba(0,0,0,0.3);transition:all 0.3s ease}
.add-post-btn:hover{transform:scale(1.1);background:#5568d3}
.success,.error{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:15px 30px;border-radius:8px;color:white;z-index:3000;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,0.3);animation:slideDown 0.3s ease}
.success{background:#2ecc71}
.error{background:#e74c3c}
@keyframes slideDown{from{top:-100px;opacity:0}to{top:20px;opacity:1}}
@media(max-width:768px){
    header h1{font-size:2.5em}
    header p{font-size:1.1em}
    .posts-grid{grid-template-columns:1fr;gap:20px}
    .post-card{padding:20px}
    .modal-content{padding:25px}
    nav{gap:10px}
    .nav-btn{padding:10px 20px;font-size:0.9em}
    .add-post-btn{bottom:20px;right:20px;width:50px;height:50px;font-size:1.5em}
}
</style>
</head>
<body>
<button class="admin-btn" onclick="toggleAdmin()">Admin</button>
<div class="container">
<header>
<h1>Ryan's Poetic and Literary Insights</h1>
<p>A collection of thoughts, stories, and poetry</p>
</header>
<nav role="navigation" aria-label="Content filter">
<button class="nav-btn active" onclick="filterPosts('all',event)" aria-label="Show all posts">All</button>
<button class="nav-btn" onclick="filterPosts('article',event)" aria-label="Show articles only">Articles</button>
<button class="nav-btn" onclick="filterPosts('poem',event)" aria-label="Show poems only">Poems</button>
</nav>
<main id="posts-container" class="posts-grid">
<div class="loading-container">
<div class="spinner"></div>
<p>Loading posts...</p>
</div>
</main>
</div>
<footer>
<p>&copy; 2024 Ryan's Poetic and Literary Insights</p>
<p>Crafted with ❤️ and words</p>
<p><a href="mailto:ryanlist35@gmail.com">Contact</a> | <a href="#" onclick="document.getElementById('about-modal').classList.add('active'); return false;">About</a></p>
</footer>
<div id="admin-modal" class="modal">
<div class="modal-content">
<h2 id="modal-title"></h2>
<div id="modal-body"></div>
</div>
</div>
<div id="about-modal" class="modal" onclick="if(event.target===this) this.classList.remove('active')">
<div class="modal-content">
<h2>About This Blog</h2>
<p style="line-height:1.8;color:#666;margin-top:20px;">Welcome to my corner of the internet where I share my thoughts, poetry, and literary musings. This space is dedicated to exploring the beauty of words and the depth of human experience through creative writing.</p>
<button class="btn btn-secondary" style="margin-top:20px;" onclick="document.getElementById('about-modal').classList.remove('active')">Close</button>
</div>
</div>
<button id="add-btn" class="add-post-btn" onclick="openAddPost()" aria-label="Add new post">+</button>

<!-- Load Supabase with async to not block rendering -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async></script>
<script>
const SUPABASE_URL="https://zqmgtnnwrceagkshfapq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbWd0bm53cmNlYWdrc2hmYXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDI2ODgsImV4cCI6MjA4MjI3ODY4OH0.Ql5KP6nfOSRzz1Z2eyN6WTqDsfVwZ0e9GKIbePa9eZE";

let sb;
let isAdmin=false;
let allPosts=[];
let currentFilter="all";

// Cache posts in localStorage for 5 minutes
const CACHE_KEY = 'blog_posts_cache';
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

function getCachedPosts() {
    try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return null;
        
        const {data, timestamp} = JSON.parse(cached);
        const now = Date.now();
        
        // Check if cache is still valid
        if (now - timestamp < CACHE_DURATION) {
            return data;
        }
        
        // Cache expired
        localStorage.removeItem(CACHE_KEY);
        return null;
    } catch (e) {
        return null;
    }
}

function setCachedPosts(posts) {
    try {
        const cacheData = {
            data: posts,
            timestamp: Date.now()
        };
        localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
    } catch (e) {
        // Ignore if localStorage is full
    }
}

// Initialize Supabase when library loads
function initSupabase() {
    if (window.supabase) {
        sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        loadPosts();
    } else {
        // Retry if library not loaded yet
        setTimeout(initSupabase, 100);
    }
}

async function loadPosts() {
    try {
        // Try to load from cache first
        const cachedPosts = getCachedPosts();
        if (cachedPosts) {
            allPosts = cachedPosts;
            displayPosts();
            // Still fetch fresh data in background
            fetchPostsInBackground();
            return;
        }
        
        // No cache, show loading and fetch
        const {data, error} = await Promise.race([
            sb.from('posts').select('id,title,type,content,created_at').order('created_at', {ascending: false}),
            new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 10000))
        ]);
        
        if (error) throw error;
        
        allPosts = data || [];
        setCachedPosts(allPosts);
        displayPosts();
    } catch (err) {
        console.error('Error loading posts:', err);
        
        // Try to show cached data even if expired
        const cachedPosts = getCachedPosts();
        if (cachedPosts) {
            allPosts = cachedPosts;
            displayPosts();
            showMessage('Showing cached posts. Network connection slow.', 'error');
        } else {
            document.getElementById('posts-container').innerHTML = 
                '<div class="empty-state"><h3>Connection Error</h3><p>Unable to load posts. Please check your internet connection and try refreshing the page.</p></div>';
        }
    }
}

async function fetchPostsInBackground() {
    try {
        const {data, error} = await sb.from('posts').select('id,title,type,content,created_at').order('created_at', {ascending: false});
        if (!error && data) {
            allPosts = data;
            setCachedPosts(allPosts);
            displayPosts();
        }
    } catch (e) {
        // Silently fail - user already has cached data
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'});
}

function displayPosts() {
    const container = document.getElementById('posts-container');
    const filtered = currentFilter === 'all' ? allPosts : allPosts.filter(p => p.type === currentFilter);
    
    if (filtered.length === 0) {
        container.innerHTML = '<div class="empty-state"><h3>No posts yet</h3><p>Check back soon for new content!</p></div>';
        return;
    }
    
    container.innerHTML = filtered.map(post => `
        <article class="post-card ${escapeHtml(post.type)}" onclick="${isAdmin ? `openEditPost(${post.id})` : ''}">
            <h3>${escapeHtml(post.title)}</h3>
            <p class="post-date">${formatDate(post.created_at)}</p>
            <p class="post-excerpt">${escapeHtml(post.content.substring(0, 150))}${post.content.length > 150 ? '...' : ''}</p>
        </article>
    `).join('');
}

function filterPosts(type, event) {
    currentFilter = type;
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    displayPosts();
}

function toggleAdmin() {
    if (isAdmin) {
        isAdmin = false;
        document.getElementById('add-btn').style.display = 'none';
        document.querySelector('.admin-btn').textContent = 'Admin';
        displayPosts();
    } else {
        showLogin();
    }
}

function showLogin() {
    const modal = document.getElementById('admin-modal');
    document.getElementById('modal-title').textContent = 'Admin Login';
    document.getElementById('modal-body').innerHTML = `
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="admin-email" placeholder="admin@example.com">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="admin-password" placeholder="Password">
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="login()">Login</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
}

async function login() {
    const email = document.getElementById('admin-email').value;
    const password = document.getElementById('admin-password').value;
    
    try {
        const {data, error} = await sb.auth.signInWithPassword({email, password});
        if (error) throw error;
        
        isAdmin = true;
        document.getElementById('add-btn').style.display = 'block';
        document.querySelector('.admin-btn').textContent = 'Logout';
        closeModal();
        showMessage('Logged in successfully!', 'success');
        displayPosts();
    } catch (err) {
        showMessage('Login failed: ' + err.message, 'error');
    }
}

function openAddPost() {
    const modal = document.getElementById('admin-modal');
    document.getElementById('modal-title').textContent = 'Add New Post';
    document.getElementById('modal-body').innerHTML = `
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="post-title" placeholder="Enter title">
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select id="post-type">
                <option value="article">Article</option>
                <option value="poem">Poem</option>
            </select>
        </div>
        <div class="form-group">
            <label>Content:</label>
            <textarea id="post-content" placeholder="Write your post here..."></textarea>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="savePost()">Save Post</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
}

async function savePost() {
    const title = document.getElementById('post-title').value;
    const type = document.getElementById('post-type').value;
    const content = document.getElementById('post-content').value;
    
    if (!title || !content) {
        showMessage('Please fill in all fields', 'error');
        return;
    }
    
    try {
        const {error} = await sb.from('posts').insert([{title, type, content}]);
        if (error) throw error;
        
        closeModal();
        showMessage('Post added successfully!', 'success');
        localStorage.removeItem(CACHE_KEY); // Clear cache
        await loadPosts();
    } catch (err) {
        showMessage('Error saving post: ' + err.message, 'error');
    }
}

function openEditPost(id) {
    if (!isAdmin) return;
    
    const post = allPosts.find(p => p.id === id);
    if (!post) return;
    
    const modal = document.getElementById('admin-modal');
    document.getElementById('modal-title').textContent = 'Edit Post';
    document.getElementById('modal-body').innerHTML = `
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="edit-title" value="${escapeHtml(post.title)}">
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select id="edit-type">
                <option value="article" ${post.type === 'article' ? 'selected' : ''}>Article</option>
                <option value="poem" ${post.type === 'poem' ? 'selected' : ''}>Poem</option>
            </select>
        </div>
        <div class="form-group">
            <label>Content:</label>
            <textarea id="edit-content">${escapeHtml(post.content)}</textarea>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="updatePost(${id})">Update</button>
            <button class="btn btn-danger" onclick="deletePost(${id})">Delete</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
}

async function updatePost(id) {
    const title = document.getElementById('edit-title').value;
    const type = document.getElementById('edit-type').value;
    const content = document.getElementById('edit-content').value;
    
    if (!title || !content) {
        showMessage('Please fill in all fields', 'error');
        return;
    }
    
    try {
        const {error} = await sb.from('posts').update({title, type, content}).eq('id', id);
        if (error) throw error;
        
        closeModal();
        showMessage('Post updated successfully!', 'success');
        localStorage.removeItem(CACHE_KEY); // Clear cache
        await loadPosts();
    } catch (err) {
        showMessage('Error updating post: ' + err.message, 'error');
    }
}

async function deletePost(id) {
    if (!confirm('Are you sure you want to delete this post?')) return;
    
    try {
        const {error} = await sb.from('posts').delete().eq('id', id);
        if (error) throw error;
        
        closeModal();
        showMessage('Post deleted successfully!', 'success');
        localStorage.removeItem(CACHE_KEY); // Clear cache
        await loadPosts();
    } catch (err) {
        showMessage('Error deleting post: ' + err.message, 'error');
    }
}

function closeModal() {
    document.getElementById('admin-modal').classList.remove('active');
    document.getElementById('about-modal').classList.remove('active');
}

function showMessage(text, type) {
    const msg = document.createElement('div');
    msg.className = type;
    msg.textContent = text;
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 3000);
}

document.getElementById("admin-modal").addEventListener("click", function(e) {
    if (e.target === this) closeModal();
});

document.addEventListener("keydown", function(e) {
    if (e.key === "Escape") closeModal();
});

// Start loading when Supabase is ready
initSupabase();
</script>
</body>
</html>