<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYGKTNNN1P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DYGKTNNN1P');
</script>

<title>Ryan's Poetic and Literary Insights - Poetry, Stories & Articles</title>
<meta name="description" content="Explore Ryan's collection of poetry, literary articles, and creative writing. Discover thought-provoking stories and beautiful poems about life, art, and culture.">
<meta name="keywords" content="poetry blog, literary blog, creative writing, Ryan poetry, modern poetry, literary articles, poems about life, short stories, contemporary poetry, literary analysis">
<meta name="author" content="Ryan">
<meta name="robots" content="index, follow">
<meta http-equiv="content-language" content="en-US">
<meta name="google-site-verification" content="gG_nQgnPK8582sxGXlIWrEF7P5q7-jtYZ5MRZUBzwpo" />

<!-- Canonical URL -->
<link rel="canonical" href="https://poeticandliteraryinsights.com/">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://poeticandliteraryinsights.com/">
<meta property="og:title" content="Ryan's Poetic and Literary Insights">
<meta property="og:description" content="A collection of poetry, stories, and literary articles">
<meta property="og:site_name" content="Ryan's Poetic and Literary Insights">
<meta property="og:locale" content="en_US">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Ryan's Poetic and Literary Insights">
<meta name="twitter:description" content="A collection of poetry, stories, and literary articles">

<link rel="preconnect" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="dns-prefetch" href="https://zqmgtnnwrceagkshfapq.supabase.co">
<link rel="preconnect" href="https://www.googletagmanager.com">
<link rel="dns-prefetch" href="https://www.googletagmanager.com">

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Ryan's Poetic and Literary Insights",
  "description": "A collection of poetry, stories, and literary articles",
  "url": "https://poeticandliteraryinsights.com/",
  "author": {
    "@type": "Person",
    "name": "Ryan",
    "email": "ryanlist35@gmail.com"
  },
  "publisher": {
    "@type": "Person",
    "name": "Ryan"
  },
  "inLanguage": "en-US"
}
</script>

<style>
:root{
  --bg-gradient-start:#667eea;
  --bg-gradient-end:#764ba2;
  --card-bg:#ffffff;
  --text-primary:#333333;
  --text-secondary:#666666;
  --text-muted:#999999;
  --border-color:#ddd;
  --shadow:rgba(0,0,0,0.2);
  --accent-blue:#667eea;
  --accent-red:#ff6b6b;
}

[data-theme="dark"]{
  --bg-gradient-start:#1a1a2e;
  --bg-gradient-end:#16213e;
  --card-bg:#2a2a3e;
  --text-primary:#e0e0e0;
  --text-secondary:#b0b0b0;
  --text-muted:#808080;
  --border-color:#444;
  --shadow:rgba(0,0,0,0.5);
  --accent-blue:#7d8ef5;
  --accent-red:#ff8787;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,var(--bg-gradient-start),var(--bg-gradient-end));color:var(--text-primary);line-height:1.6;min-height:100vh;transition:background 0.3s ease}
.container{max-width:1200px;margin:0 auto;padding:20px}
header{text-align:center;padding:60px 20px;color:white}
header h1{font-size:3.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}
header p{font-size:1.3em;opacity:0.9}
.breadcrumb{color:rgba(255,255,255,0.9);padding:10px 20px;font-size:0.9em;text-align:center}
.breadcrumb a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);transition:opacity 0.3s}
.breadcrumb a:hover{opacity:0.7}
.search-container{max-width:600px;margin:20px auto;padding:0 20px}
.search-box{width:100%;padding:15px 20px;border-radius:30px;border:2px solid white;background:rgba(255,255,255,0.2);color:white;font-size:1em;transition:all 0.3s ease}
.search-box::placeholder{color:rgba(255,255,255,0.7)}
.search-box:focus{outline:none;background:rgba(255,255,255,0.3);transform:translateY(-2px)}
nav{display:flex;justify-content:center;gap:20px;margin:30px 0;flex-wrap:wrap}
.nav-btn{padding:12px 30px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:30px;transition:all 0.3s ease;font-size:1em}
.nav-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-2px)}
.nav-btn.active{background:white;color:var(--accent-blue);font-weight:bold}
.posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:30px;margin-bottom:40px}
.post-card{background:var(--card-bg);border-radius:15px;padding:30px;box-shadow:0 10px 30px var(--shadow);cursor:pointer;transition:transform 0.3s ease,box-shadow 0.3s ease;text-decoration:none;color:var(--text-primary);display:block}
.post-card:hover{transform:translateY(-5px);box-shadow:0 15px 40px var(--shadow)}
.post-card h3{color:var(--accent-blue);margin-bottom:10px;font-size:1.5em}
.post-card.poem{font-style:italic;background:linear-gradient(135deg,#ffecd2,#fcb69f);border-left:5px solid var(--accent-red)}
[data-theme="dark"] .post-card.poem{background:linear-gradient(135deg,#3a2a1e,#2e1f14)}
.post-card.poem h3{color:var(--accent-red)}
.post-card.article{border-left:5px solid var(--accent-blue)}
.post-date{color:var(--text-muted);font-size:0.9em;margin:10px 0;font-weight:normal}
.post-excerpt{color:var(--text-secondary);line-height:1.8;margin-top:15px}
.reading-time{display:inline-flex;align-items:center;gap:5px;color:var(--text-muted);font-size:0.85em;margin-top:10px;padding:5px 12px;background:rgba(102,126,234,0.1);border-radius:15px}
.reading-time::before{content:"üìñ"}
.loading-container{color:white;text-align:center;padding:80px 20px;font-size:1.2em}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;border-top:4px solid white;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.empty-state{color:white;text-align:center;padding:80px 20px;font-size:1.2em;background:rgba(255,255,255,0.1);border-radius:15px;margin:20px 0}
.empty-state h3{font-size:1.8em;margin-bottom:15px}

.pagination{display:flex;justify-content:center;align-items:center;gap:15px;margin:40px 0 60px;flex-wrap:wrap}
.pagination-btn{padding:12px 24px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:30px;transition:all 0.3s ease;font-size:1em;font-weight:bold}
.pagination-btn:hover:not(:disabled){background:rgba(255,255,255,0.3);transform:translateY(-2px)}
.pagination-btn:disabled{opacity:0.4;cursor:not-allowed}
.pagination-info{color:white;font-size:1.1em;padding:10px 20px;background:rgba(255,255,255,0.15);border-radius:25px;font-weight:500}
.page-numbers{display:flex;gap:8px;align-items:center}
.page-number{padding:10px 16px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:50%;transition:all 0.3s ease;font-size:0.95em;min-width:44px;text-align:center}
.page-number:hover{background:rgba(255,255,255,0.3);transform:scale(1.1)}
.page-number.active{background:white;color:var(--accent-blue);font-weight:bold}
.page-ellipsis{color:white;font-size:1.2em;padding:0 5px}

footer{background:rgba(0,0,0,0.3);color:white;text-align:center;padding:30px 20px;margin-top:60px}
footer p{margin:5px 0;opacity:0.9}
footer a{color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.5);transition:opacity 0.3s}
footer a:hover{opacity:0.7}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:2000;justify-content:center;align-items:center;padding:20px}
.modal.active{display:flex}
.modal-content{background:var(--card-bg);padding:40px;border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}
.modal-content h2{color:var(--accent-blue);margin-bottom:25px;font-size:2em}
.form-group{margin-bottom:20px}
.form-group label{font-weight:bold;display:block;margin-bottom:8px;color:var(--accent-blue)}
.form-group input,textarea,select{width:100%;padding:12px;border-radius:8px;border:2px solid var(--border-color);font-family:inherit;font-size:1em;transition:border-color 0.3s;background:var(--card-bg);color:var(--text-primary)}
.form-group input:focus,textarea:focus,select:focus{outline:none;border-color:var(--accent-blue)}
textarea{min-height:200px;resize:vertical}
.btn-group{display:flex;gap:15px;margin-top:20px;flex-wrap:wrap}
.btn{padding:15px 30px;border-radius:8px;cursor:pointer;border:none;font-size:1em;transition:all 0.3s ease;font-weight:bold}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.btn-primary{background:var(--accent-blue);color:white}
.btn-primary:hover{background:#5568d3}
.btn-secondary{background:#ddd;color:#333}
.btn-secondary:hover{background:#ccc}
.btn-danger{background:#e74c3c;color:white}
.btn-danger:hover{background:#c0392b}
.admin-btn{position:fixed;top:20px;right:80px;padding:10px 20px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:25px;z-index:100;transition:all 0.3s ease;font-weight:bold}
.admin-btn:hover{background:rgba(255,255,255,0.3)}
.theme-toggle{position:fixed;top:20px;right:20px;width:50px;height:50px;background:rgba(255,255,255,0.2);border:2px solid white;color:white;cursor:pointer;border-radius:50%;z-index:100;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;font-size:1.5em}
.theme-toggle:hover{background:rgba(255,255,255,0.3);transform:rotate(20deg)}
.add-post-btn{position:fixed;bottom:40px;right:40px;width:60px;height:60px;background:var(--accent-blue);color:white;border-radius:50%;font-size:2em;border:none;cursor:pointer;display:none;z-index:1000;box-shadow:0 5px 20px var(--shadow);transition:all 0.3s ease}
.add-post-btn:hover{transform:scale(1.1);background:#5568d3}
.success,.error{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:15px 30px;border-radius:8px;color:white;z-index:3000;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,0.3);animation:slideDown 0.3s ease}
.success{background:#2ecc71}
.error{background:#e74c3c}
@keyframes slideDown{from{top:-100px;opacity:0}to{top:20px;opacity:1}}
@media(max-width:768px){
    header h1{font-size:2.5em}
    header p{font-size:1.1em}
    .posts-grid{grid-template-columns:1fr;gap:20px}
    .post-card{padding:20px}
    .modal-content{padding:25px}
    nav{gap:10px}
    .nav-btn{padding:10px 20px;font-size:0.9em}
    .add-post-btn{bottom:20px;right:20px;width:50px;height:50px;font-size:1.5em}
    .admin-btn{top:80px;right:20px;font-size:0.9em;padding:8px 16px}
    .pagination{gap:8px}
    .pagination-btn{padding:10px 18px;font-size:0.9em}
    .pagination-info{font-size:0.95em;padding:8px 16px}
    .page-number{padding:8px 12px;min-width:38px;font-size:0.9em}
}
</style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô</button>
<button class="admin-btn" onclick="toggleAdmin()">Admin</button>
<div class="container">
<header itemscope itemtype="https://schema.org/WPHeader">
<h1 itemprop="headline">Ryan's Poetic and Literary Insights</h1>
<p itemprop="description">A collection of thoughts, stories, and poetry</p>
</header>

<nav class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList" aria-label="Breadcrumb">
  <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="https://poeticandliteraryinsights.com/">
      <span itemprop="name">Home</span>
    </a>
    <meta itemprop="position" content="1">
  </span>
</nav>

<div class="search-container">
  <input type="text" id="search-box" class="search-box" placeholder="üîç Search posts..." oninput="handleSearch()" aria-label="Search posts">
</div>

<nav role="navigation" aria-label="Content filter" itemscope itemtype="https://schema.org/SiteNavigationElement">
<button class="nav-btn active" onclick="filterPosts('all',event)" aria-label="Show all posts" itemprop="name">All</button>
<button class="nav-btn" onclick="filterPosts('article',event)" aria-label="Show articles only" itemprop="name">Articles</button>
<button class="nav-btn" onclick="filterPosts('poem',event)" aria-label="Show poems only" itemprop="name">Poems</button>
</nav>

<main id="posts-container" class="posts-grid">
<noscript>
  <div class="empty-state">
    <h3>JavaScript Required</h3>
    <p>This site requires JavaScript to display content. Please enable JavaScript in your browser settings.</p>
  </div>
</noscript>
<div class="loading-container">
<div class="spinner"></div>
<p>Loading posts...</p>
</div>
</main>

<div id="pagination-container"></div>
</div>

<footer itemscope itemtype="https://schema.org/WPFooter">
<p>&copy; <span itemprop="copyrightYear">2024</span> <span itemprop="copyrightHolder">Ryan's Poetic and Literary Insights</span></p>
<p>Crafted with ‚ù§Ô∏è and words</p>
<p><a href="mailto:ryanlist35@gmail.com" itemprop="email">Contact</a> | <a href="#" onclick="document.getElementById('about-modal').classList.add('active'); return false;">About</a></p>
</footer>

<div id="admin-modal" class="modal">
<div class="modal-content">
<h2 id="modal-title"></h2>
<div id="modal-body"></div>
</div>
</div>

<div id="about-modal" class="modal" onclick="if(event.target===this) this.classList.remove('active')">
<div class="modal-content">
<h2>About This Blog</h2>
<p style="line-height:1.8;color:var(--text-secondary);margin-top:20px;">Welcome to my corner of the internet where I share my thoughts, poetry, and literary musings. This space is dedicated to exploring the beauty of words and the depth of human experience through creative writing.</p>
<button class="btn btn-secondary" style="margin-top:20px;" onclick="document.getElementById('about-modal').classList.remove('active')">Close</button>
</div>
</div>

<button id="add-btn" class="add-post-btn" onclick="openAddPost()" aria-label="Add new post">+</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" async defer></script>
<script>
const SUPABASE_URL="https://zqmgtnnwrceagkshfapq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxbWd0bm53cmNlYWdrc2hmYXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDI2ODgsImV4cCI6MjA4MjI3ODY4OH0.Ql5KP6nfOSRzz1Z2eyN6WTqDsfVwZ0e9GKIbePa9eZE";

let sb;
let isAdmin=false;
let allPosts=[];
let currentFilter="all";
let currentPage=1;
let searchQuery="";
const POSTS_PER_PAGE=10;

const CACHE_KEY='blog_posts_cache_v4';
const CACHE_DURATION=30*60*1000;

function loadTheme(){
    const theme=localStorage.getItem('theme')||'light';
    document.documentElement.setAttribute('data-theme',theme);
    document.querySelector('.theme-toggle').textContent=theme==='dark'?'‚òÄÔ∏è':'üåô';
}

function toggleTheme(){
    const current=document.documentElement.getAttribute('data-theme')||'light';
    const next=current==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    document.querySelector('.theme-toggle').textContent=next==='dark'?'‚òÄÔ∏è':'üåô';
}

function calculateReadingTime(text){
    const wordsPerMinute=200;
    const words=text.trim().split(/\s+/).length;
    const minutes=Math.ceil(words/wordsPerMinute);
    return minutes;
}

function getCachedPosts(){
    try{
        const cached=localStorage.getItem(CACHE_KEY);
        if(!cached)return null;
        const{data,timestamp}=JSON.parse(cached);
        if(Date.now()-timestamp<CACHE_DURATION)return data;
        localStorage.removeItem(CACHE_KEY);
        return null;
    }catch(e){return null}
}

function setCachedPosts(posts){
    try{
        localStorage.setItem(CACHE_KEY,JSON.stringify({data:posts,timestamp:Date.now()}));
    }catch(e){}
}

function initSupabase(){
    if(window.supabase){
        sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
        loadPosts();
    }else{
        setTimeout(initSupabase,100);
    }
}

async function loadPosts(){
    try{
        const cachedPosts=getCachedPosts();
        if(cachedPosts){
            allPosts=cachedPosts;
            displayPosts();
            injectStructuredData();
            fetchPostsInBackground();
            return;
        }
        
        const{data,error}=await Promise.race([
            sb.from('posts').select('id,title,type,content,created_at').order('created_at',{ascending:false}),
            new Promise((_,reject)=>setTimeout(()=>reject(new Error('Timeout')),8000))
        ]);
        
        if(error)throw error;
        
        allPosts=data||[];
        setCachedPosts(allPosts);
        displayPosts();
        injectStructuredData();
    }catch(err){
        console.error('Error loading posts:',err);
        const cachedPosts=getCachedPosts();
        if(cachedPosts){
            allPosts=cachedPosts;
            displayPosts();
            injectStructuredData();
            showMessage('Showing cached posts','error');
        }else{
            document.getElementById('posts-container').innerHTML=
                '<div class="empty-state"><h3>Connection Error</h3><p>Unable to load posts. Please check your internet connection and try refreshing the page.</p></div>';
        }
    }
}

async function fetchPostsInBackground(){
    try{
        const{data,error}=await sb.from('posts').select('id,title,type,content,created_at').order('created_at',{ascending:false});
        if(!error&&data){
            allPosts=data;
            setCachedPosts(allPosts);
            displayPosts();
            injectStructuredData();
        }
    }catch(e){}
}

function injectStructuredData(){
    const existingScript=document.getElementById('blog-posts-schema');
    if(existingScript)existingScript.remove();
    
    const blogPosts=allPosts.filter(post=>post.created_at).slice(0,10).map(post=>({
        "@type":"BlogPosting",
        "headline":post.title,
        "datePublished":post.created_at,
        "dateModified":post.created_at,
        "author":{"@type":"Person","name":"Ryan"},
        "publisher":{"@type":"Person","name":"Ryan"},
        "description":post.content.substring(0,150),
        "url":`https://poeticandliteraryinsights.com/post.html?id=${post.id}`,
        "mainEntityOfPage":{
            "@type":"WebPage",
            "@id":`https://poeticandliteraryinsights.com/post.html?id=${post.id}`
        },
        "articleBody":post.content.substring(0,500),
        "wordCount":post.content.split(/\s+/).length,
        "inLanguage":"en-US"
    }));
    
    const schema={
        "@context":"https://schema.org",
        "@graph":[
            {
                "@type":"Blog",
                "name":"Ryan's Poetic and Literary Insights",
                "url":"https://poeticandliteraryinsights.com/",
                "blogPost":blogPosts
            }
        ]
    };
    
    const script=document.createElement('script');
    script.type='application/ld+json';
    script.id='blog-posts-schema';
    script.textContent=JSON.stringify(schema);
    document.head.appendChild(script);
}

function escapeHtml(text){
    const div=document.createElement('div');
    div.textContent=text;
    return div.innerHTML;
}

function formatDate(dateString){
    if(!dateString)return null;
    const date=new Date(dateString);
    if(isNaN(date.getTime()))return null;
    return date.toLocaleDateString('en-US',{
        timeZone:'UTC',
        year:'numeric',
        month:'long',
        day:'numeric'
    });
}

function handleSearch(){
    searchQuery=document.getElementById('search-box').value.toLowerCase();
    currentPage=1;
    displayPosts();
}

function getFilteredPosts(){
    let filtered=allPosts;
    
    if(currentFilter!=='all'){
        filtered=filtered.filter(p=>p.type===currentFilter);
    }
    
    if(searchQuery){
        filtered=filtered.filter(p=>
            p.title.toLowerCase().includes(searchQuery)||
            p.content.toLowerCase().includes(searchQuery)
        );
    }
    
    return filtered;
}

function renderPagination(filteredPosts){
    const totalPages=Math.ceil(filteredPosts.length/POSTS_PER_PAGE);
    
    if(totalPages<=1){
        document.getElementById('pagination-container').innerHTML='';
        return;
    }
    
    const maxVisiblePages=5;
    let startPage=Math.max(1,currentPage-Math.floor(maxVisiblePages/2));
    let endPage=Math.min(totalPages,startPage+maxVisiblePages-1);
    
    if(endPage-startPage+1<maxVisiblePages){
        startPage=Math.max(1,endPage-maxVisiblePages+1);
    }
    
    let pageNumbers='';
    
    if(startPage>1){
        pageNumbers+=`<button class="page-number" onclick="goToPage(1)" aria-label="Go to page 1">1</button>`;
        if(startPage>2){
            pageNumbers+=`<span class="page-ellipsis">...</span>`;
        }
    }
    
    for(let i=startPage;i<=endPage;i++){
        pageNumbers+=`<button class="page-number ${i===currentPage?'active':''}" onclick="goToPage(${i})" aria-label="Go to page ${i}" ${i===currentPage?'aria-current="page"':''}>${i}</button>`;
    }
    
    if(endPage<totalPages){
        if(endPage<totalPages-1){
            pageNumbers+=`<span class="page-ellipsis">...</span>`;
        }
        pageNumbers+=`<button class="page-number" onclick="goToPage(${totalPages})" aria-label="Go to page ${totalPages}">${totalPages}</button>`;
    }
    
    const startPost=(currentPage-1)*POSTS_PER_PAGE+1;
    const endPost=Math.min(currentPage*POSTS_PER_PAGE,filteredPosts.length);
    
    document.getElementById('pagination-container').innerHTML=`
        <nav class="pagination" aria-label="Pagination">
            <button class="pagination-btn" onclick="goToPage(${currentPage-1})" ${currentPage===1?'disabled':''} aria-label="Previous page">
                ‚Üê Previous
            </button>
            <div class="page-numbers" role="navigation" aria-label="Page numbers">
                ${pageNumbers}
            </div>
            <span class="pagination-info" aria-live="polite">${startPost}-${endPost} of ${filteredPosts.length}</span>
            <button class="pagination-btn" onclick="goToPage(${currentPage+1})" ${currentPage===totalPages?'disabled':''} aria-label="Next page">
                Next ‚Üí
            </button>
        </nav>
    `;
}

function goToPage(page){
    const filtered=getFilteredPosts();
    const totalPages=Math.ceil(filtered.length/POSTS_PER_PAGE);
    
    if(page<1||page>totalPages)return;
    
    currentPage=page;
    displayPosts();
    window.scrollTo({top:0,behavior:'smooth'});
}

function displayPosts(){
    const container=document.getElementById('posts-container');
    const filtered=getFilteredPosts();
    
    if(filtered.length===0){
        const message=searchQuery?`No posts found for "${searchQuery}"`:'No posts yet';
        const subMessage=searchQuery?'Try a different search term':'Check back soon for new content!';
        container.innerHTML=`<div class="empty-state"><h3>${message}</h3><p>${subMessage}</p></div>`;
        document.getElementById('pagination-container').innerHTML='';
        return;
    }
    
    const startIndex=(currentPage-1)*POSTS_PER_PAGE;
    const endIndex=startIndex+POSTS_PER_PAGE;
    const postsToShow=filtered.slice(startIndex,endIndex);
    
    if(isAdmin){
        container.innerHTML=postsToShow.map(post=>{
            const readTime=calculateReadingTime(post.content);
            const formattedDate=formatDate(post.created_at);
            return `
            <article class="post-card ${escapeHtml(post.type)}" data-post-id="${post.id}" style="cursor:pointer;" itemscope itemtype="https://schema.org/BlogPosting">
                <h3 itemprop="headline">${escapeHtml(post.title)}</h3>
                ${formattedDate?`<p class="post-date">
                    <time itemprop="datePublished" datetime="${post.created_at}">
                        ${formattedDate}
                    </time>
                </p>`:''}
                <span class="reading-time" itemprop="timeRequired" content="PT${readTime}M">${readTime} min read</span>
                <p class="post-excerpt" itemprop="description">${escapeHtml(post.content.substring(0,150))}${post.content.length>150?'...':''}</p>
                <meta itemprop="author" content="Ryan">
                <link itemprop="url" href="post.html?id=${post.id}">
            </article>
        `}).join('');
        
        document.querySelectorAll('.post-card').forEach(card=>{
            card.addEventListener('click',function(e){
                e.preventDefault();
                const postId=String(this.getAttribute('data-post-id'));
                openEditPost(postId);
            });
        });
    }else{
        container.innerHTML=postsToShow.map(post=>{
            const readTime=calculateReadingTime(post.content);
            const postUrl=`post.html?id=${post.id}`;
            const formattedDate=formatDate(post.created_at);
            return `
            <a href="${postUrl}" class="post-card ${escapeHtml(post.type)}" itemscope itemtype="https://schema.org/BlogPosting">
                <h3 itemprop="headline">${escapeHtml(post.title)}</h3>
                ${formattedDate?`<p class="post-date">
                    <time itemprop="datePublished" datetime="${post.created_at}">
                        ${formattedDate}
                    </time>
                </p>`:''}
                <span class="reading-time" itemprop="timeRequired" content="PT${readTime}M">${readTime} min read</span>
                <p class="post-excerpt" itemprop="description">${escapeHtml(post.content.substring(0,150))}${post.content.length>150?'...':''}</p>
                <meta itemprop="author" content="Ryan">
                <link itemprop="url" href="${postUrl}">
            </a>
        `}).join('');
        
        document.querySelectorAll('a[href^="post.html"]').forEach(link=>{
            link.addEventListener('mouseenter',function(){
                const postId=new URL(this.href,window.location.href).searchParams.get('id');
                if(postId)prefetchPost(postId);
            },{once:true});
        });
    }
    
    renderPagination(filtered);
}

function prefetchPost(id){
    const CACHE_PREFIX='post_';
    try{
        const cached=localStorage.getItem(CACHE_PREFIX+id);
        if(cached)return;
    }catch(e){}
    
    sb.from("posts").select("*").eq("id",id).single().then(({data})=>{
        if(data){
            try{
                localStorage.setItem(CACHE_PREFIX+id,JSON.stringify({data:data,timestamp:Date.now()}));
            }catch(e){}
        }
    });
}

function filterPosts(type,event){
    currentFilter=type;
    currentPage=1;
    document.querySelectorAll('.nav-btn').forEach(btn=>btn.classList.remove('active'));
    event.target.classList.add('active');
    displayPosts();
}

function toggleAdmin(){
    if(isAdmin){
        isAdmin=false;
        document.getElementById('add-btn').style.display='none';
        document.querySelector('.admin-btn').textContent='Admin';
        displayPosts();
    }else{
        showLogin();
    }
}

function showLogin(){
    const modal=document.getElementById('admin-modal');
    document.getElementById('modal-title').textContent='Admin Login';
    document.getElementById('modal-body').innerHTML=`
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="admin-email" placeholder="admin@example.com">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="admin-password" placeholder="Password">
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="login()">Login</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
}

async function login(){
    const email=document.getElementById('admin-email').value;
    const password=document.getElementById('admin-password').value;
    
    try{
        const{data,error}=await sb.auth.signInWithPassword({email,password});
        if(error)throw error;
        
        isAdmin=true;
        document.getElementById('add-btn').style.display='block';
        document.querySelector('.admin-btn').textContent='Logout';
        closeModal();
        showMessage('Logged in successfully!','success');
        displayPosts();
    }catch(err){
        showMessage('Login failed: '+err.message,'error');
    }
}

function openAddPost(){
    const modal=document.getElementById('admin-modal');
    document.getElementById('modal-title').textContent='Add New Post';
    document.getElementById('modal-body').innerHTML=`
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="post-title" placeholder="Enter title">
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select id="post-type">
                <option value="article">Article</option>
                <option value="poem">Poem</option>
            </select>
        </div>
        <div class="form-group">
            <label>Content:</label>
            <textarea id="post-content" placeholder="Write your post here..."></textarea>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="savePost()">Save Post</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
}

async function savePost(){
    const title=document.getElementById('post-title').value;
    const type=document.getElementById('post-type').value;
    const content=document.getElementById('post-content').value;
    
    if(!title||!content){
        showMessage('Please fill in all fields','error');
        return;
    }
    
    try{
        const{error}=await sb.from('posts').insert([{title,type,content}]);
        if(error)throw error;
        
        closeModal();
        showMessage('Post added successfully!','success');
        localStorage.removeItem(CACHE_KEY);
        await loadPosts();
    }catch(err){
        showMessage('Error saving post: '+err.message,'error');
    }
}

function openEditPost(id){
    if(!isAdmin)return;
    
    const post=allPosts.find(p=>String(p.id)===String(id));
    if(!post){
        showMessage('Post not found','error');
        return;
    }
    
    const modal=document.getElementById('admin-modal');
    
    document.getElementById('modal-title').textContent='Edit Post';
    document.getElementById('modal-body').innerHTML=`
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="edit-title" value="">
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select id="edit-type">
                <option value="article" ${post.type==='article'?'selected':''}>Article</option>
                <option value="poem" ${post.type==='poem'?'selected':''}>Poem</option>
            </select>
        </div>
        <div class="form-group">
            <label>Content:</label>
            <textarea id="edit-content"></textarea>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="updatePost('${post.id}')">Update</button>
            <button class="btn btn-danger" onclick="deletePost('${post.id}')">Delete</button>
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
    `;
    modal.classList.add('active');
    
    document.getElementById('edit-title').value=post.title;
    document.getElementById('edit-content').value=post.content;
}

window.updatePost=async function(id){
    const title=document.getElementById('edit-title').value;
    const type=document.getElementById('edit-type').value;
    const content=document.getElementById('edit-content').value;
    
    if(!title||!content){
        showMessage('Please fill in all fields','error');
        return;
    }
    
    try{
        const{error}=await sb.from('posts').update({title,type,content}).eq('id',String(id));
        if(error)throw error;
        
        closeModal();
        showMessage('Post updated successfully!','success');
        localStorage.removeItem(CACHE_KEY);
        await loadPosts();
    }catch(err){
        showMessage('Error updating post: '+err.message,'error');
    }
}

window.deletePost=async function(id){
    if(!confirm('Are you sure you want to delete this post?'))return;
    
    try{
        const{error}=await sb.from('posts').delete().eq('id',String(id));
        if(error)throw error;
        
        closeModal();
        showMessage('Post deleted successfully!','success');
        localStorage.removeItem(CACHE_KEY);
        await loadPosts();
    }catch(err){
        showMessage('Error deleting post: '+err.message,'error');
    }
}

function closeModal(){
    document.getElementById('admin-modal').classList.remove('active');
    document.getElementById('about-modal').classList.remove('active');
}

function showMessage(text,type){
    const msg=document.createElement('div');
    msg.className=type;
    msg.textContent=text;
    msg.setAttribute('role','alert');
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
}

document.getElementById("admin-modal").addEventListener("click",function(e){
    if(e.target===this)closeModal();
});

document.addEventListener("keydown",function(e){
    if(e.key==="Escape")closeModal();
});

loadTheme();
initSupabase();
</script>
</body>
</html>
